<%- include ./layouts/head.ejs %>
<%- include ./layouts/header.ejs %>

<body>
  <main class="carrito-container">
    <h1>üöö Seleccionar Env√≠o</h1>

    <div class="progreso-compra">
      <div class="paso-container">
        <div class="paso completado">
          <i class="fas fa-shopping-cart"></i>
          <span>CARRITO</span>
        </div>

        <div class="barra activa"></div>

        <div class="paso activo">
          <i class="fas fa-truck"></i>
          <span>ENV√çO</span>
        </div>

        <div class="barra"></div>

        <div class="paso">
          <i class="fas fa-check-circle"></i>
          <span>CONFIRMAR DATOS</span>
        </div>

        <div class="barra"></div>

        <div class="paso">
          <i class="fas fa-credit-card"></i>
          <span>PAGO</span>
        </div>
      </div>
    </div>

    <div class="envio-opciones">
      <label class="opcion-envio">
        <input type="radio" name="tipo-envio" value="local">
        <i class="fas fa-store"></i> Retiro por el local
        <small style="display:block;opacity:.8;">Igualdad 88, Centro, C√≥rdoba</small>
      </label>

      <div id="info-retiro-local" class="hidden">
        <p>üìç Direcci√≥n del local: <strong>Igualdad 88, Centro, C√≥rdoba</strong></p>
      </div>

      <label class="opcion-envio">
        <input type="radio" name="tipo-envio" value="delivery">
        <i class="fas fa-motorcycle"></i> Env√≠o Delivery
      </label>

      <div id="direccion-predefinida" class="hidden">
        <p>üìç Tiene la direcci√≥n <span id="direccion-guardada"></span> predefinida para la entrega.</p>
      </div>

      <div id="spinner" class="hidden">
        <div class="spinner"></div>
        <p id="spinner-text">BUSCANDO...</p>
      </div>

      <div id="datos-envio" class="hidden">
        <input type="text" id="direccion" placeholder="Escriba su direcci√≥n">
        <button id="buscar-direccion">Buscar</button>
      </div>

      <div id="mapa-container" class="hidden">
        <h3>üìç Ubicaci√≥n</h3>
        <div id="mapa" style="height: 400px;"></div>
      </div>
    </div>

    <div>
      <button id="continuar-pago" class="btn-finalizar">Continuar con el Pago</button>
    </div>
  </main>

  <%- include ./layouts/footer.ejs %>

  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

  <script>
    document.addEventListener("DOMContentLoaded", function () {
      fetch("/carrito/envio")
        .then(r => r.json())
        .then(data => {
          if (data.direccion) {
            document.getElementById("direccion-guardada").textContent = data.direccion;
            document.getElementById("direccion-predefinida").classList.remove("hidden");
          }
        });
    });
  </script>

  <!-- ‚úÖ √öLTIMO + cache-busting -->
  <script src="/js/envio.js?v=20260108-2"></script>

</body>
