<%- include('./layouts/head.ejs') %>
<%- include('./layouts/header.ejs') %>

<body>
  <!-- ========= ESTILOS AISLADOS DEL PANEL (namespace .af-admin) ========= -->
<style>
  /* ================== ADMIN LAYOUT (COMPACT-READY) ================== */
  .af-admin {
    /* Escala base */
    --af-font-size: 14px;
    --af-gap: 16px;
    --af-col-min: 300px;         /* ‚Üì antes 340px */
    --af-card-pad: 16px;
    --af-card-br: 12px;
    --af-card-bg: #fff;
    --af-card-shadow: 0 6px 18px rgba(0,0,0,.08);
    --af-border: 1px solid rgba(31,72,126,.12);
    --af-title: #1f487e;
  }

  .af-admin__grid {
    display: grid !important;
    grid-template-columns: repeat(auto-fit, minmax(var(--af-col-min), 1fr));
    gap: var(--af-gap);
    align-items: start;
  }

  .af-card {
    background: var(--af-card-bg);
    border-radius: var(--af-card-br);
    box-shadow: var(--af-card-shadow);
    border: var(--af-border);
    padding: var(--af-card-pad);
    position: relative;
    overflow: hidden;
  }

  .af-card__title {
    margin: 0 0 10px 0;
    color: var(--af-title);
    font-weight: 700;
    /* Tipograf√≠a adaptable y m√°s chica */
    font-size: clamp(0.95rem, 1.2vw, 1.05rem);
    letter-spacing: .2px;
  }

  /* ===== Controles / Formularios m√°s compactos ===== */
  .af-admin .form-label {
    font-size: 0.9rem;
    font-weight: 600;
    color: #29486f;
    margin-bottom: .35rem;
  }

  .af-admin .form-control,
  .af-admin .form-select {
    font-size: 0.9rem;
    padding: .35rem .5rem;             /* ‚Üì padding */
    height: auto;                       /* evita alturas gigantes de BS */
    line-height: 1.25;
  }

  .af-admin .mb-3 { margin-bottom: .75rem !important; }

  /* ===== Botones compactos ===== */
  .af-actions-row {
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
    justify-content: center;
    margin-top: 10px;
  }

  .btn-admin-facturas,
  .btn-admin-presupuestos,
  .btn-admin-vencimientos {
    background: #1f487e;
    color: #fff;
    border: none;
    padding: 8px 12px;                 /* ‚Üì padding */
    border-radius: 10px;
    font-weight: 700;
    font-size: 0.92rem;                /* ‚Üì tama√±o */
    transition: transform .15s ease, box-shadow .15s ease;
  }
  .btn-admin-facturas:hover,
  .btn-admin-presupuestos:hover,
  .btn-admin-vencimientos:hover {
    transform: translateY(-1px);
    box-shadow: 0 6px 14px rgba(0,0,0,.12);
  }

  .af-admin .btn { border-radius: 10px; }
  .af-admin .btn.btn-primary,
  .af-admin .btn.btn-success,
  .af-admin .btn.btn-warning,
  .af-admin .btn.btn-danger,
  .af-admin .btn.btn-outline-secondary {
    padding: 8px 12px;                 /* ‚Üì padding global */
    font-size: 0.92rem;
  }

  /* ===== Tablas en modales m√°s densas ===== */
  .af-modal .table th, .af-modal .table td {
    vertical-align: middle;
    padding: .4rem .5rem;              /* ‚Üì padding celda */
    font-size: 0.9rem;
  }
  .af-modal .table thead th { font-weight: 700; }

  /* ===== Header de modales ===== */
  .af-modal .modal-proveedor-header { background:#1f487e; color:#fff; }
  .af-modal .btn-close-white { filter: invert(1); }

  /* ===== Ajustes finos ===== */
  .af-card .d-grid .btn-primary { border-radius: 10px; font-weight: 700; }
  .af-card .gap-2 { gap: .5rem !important; }

  /* ================================================================
     1) MODO COMPACTO AUTOM√ÅTICO PARA MONITORES PEQUE√ëOS
        (ej. 1366√ó768 o menos)
     ================================================================ */
  @media (max-width: 1366px) {
    .af-admin {
      --af-font-size: 13px;
      --af-gap: 12px;
      --af-col-min: 260px;            /* ‚Üì a√∫n m√°s chico: entran 3 columnas */
      --af-card-pad: 12px;
      --af-card-br: 10px;
    }
    .af-card__title {
      font-size: clamp(0.9rem, 1.2vw, 1rem);
      margin-bottom: 8px;
    }
    .af-admin .form-label { font-size: 0.85rem; }
    .af-admin .form-control,
    .af-admin .form-select {
      font-size: 0.85rem;
      padding: .3rem .45rem;
      line-height: 1.2;
    }
    .af-admin .mb-3 { margin-bottom: .6rem !important; }

    .btn-admin-facturas,
    .btn-admin-presupuestos,
    .btn-admin-vencimientos,
    .af-admin .btn {
      font-size: 0.88rem;
      padding: 7px 10px;
    }

    .af-modal .table th, .af-modal .table td {
      font-size: 0.85rem;
      padding: .35rem .45rem;
    }
  }

  /* ================================================================
     2) MODO COMPACTO FORZADO (opcional)
        Agreg√° la clase .af-admin--compact al <main class="af-admin ...">
     ================================================================ */
  .af-admin.af-admin--compact {
    --af-font-size: 13px;
    --af-gap: 12px;
    --af-col-min: 260px;
    --af-card-pad: 12px;
    --af-card-br: 10px;
  }
  .af-admin.af-admin--compact .af-card__title {
    font-size: clamp(0.9rem, 1.1vw, 1rem);
    margin-bottom: 8px;
  }
  .af-admin.af-admin--compact .form-label { font-size: 0.85rem; }
  .af-admin.af-admin--compact .form-control,
  .af-admin.af-admin--compact .form-select {
    font-size: 0.85rem;
    padding: .3rem .45rem;
    line-height: 1.2;
  }
  .af-admin.af-admin--compact .mb-3 { margin-bottom: .6rem !important; }
  .af-admin.af-admin--compact .btn,
  .af-admin.af-admin--compact .btn-admin-facturas,
  .af-admin.af-admin--compact .btn-admin-presupuestos,
  .af-admin.af-admin--compact .btn-admin-vencimientos {
    font-size: 0.88rem;
    padding: 7px 10px;
  }
  .af-admin.af-admin--compact .af-modal .table th,
  .af-admin.af-admin--compact .af-modal .table td {
    font-size: 0.85rem;
    padding: .35rem .45rem;
  }

  /* ================================================================
     3) ULTRA-COMPACTO para 1280px (si todav√≠a no entran 3 columnas)
     ================================================================ */
  @media (max-width: 1280px) {
    .af-admin {
      --af-col-min: 240px;            /* √∫ltimo ajuste para forzar 3 cols */
    }
  }
</style>

  <!-- ========================= FIN ESTILOS AISLADOS ======================= -->

  <main class="contenedor-proveedores af-admin">
    <!-- Forzamos el grid aunque tu CSS global haya cambiado -->
    <div class="contenedor-admin-flex af-admin__grid">

      <!-- =============== PROVEEDORES =============== -->
              <!-- Bot√≥n de acceso al Panel de Objetivos -->
      <div class="af-actions-row" style="margin-bottom:12px;">
      <a href="/administracion/objetivos" class="btn btn-outline-primary" style="font-weight:700;border-radius:10px;">
       üéØ Objetivos del Negocio
      </a>
      </div>
      <section class="panel-proveedores af-card" data-af="proveedores">
        <h5 class="af-card__title">Proveedor</h5>

        <div class="acciones-proveedor d-flex gap-2 mb-2">
          <button id="btnNuevoProveedor" class="btn btn-sm btn-success">+ Nuevo</button>
          <button id="btnEditarProveedor" class="btn btn-sm btn-warning" disabled>Editar</button>
          <button id="btnEliminarProveedorDirecto" class="btn btn-sm btn-danger" disabled>Eliminar</button>
        </div>

        <select id="selectProveedor" class="form-select mb-2">
          <option value="">Cargando...</option>
        </select>

        <div id="detalleProveedor" class="detalle-proveedor">
          <p id="bloqueDescuentoProveedor" class="d-none">
            <strong>Descuento:</strong> <span id="descuentoProveedorView">-</span>
          </p>
        </div>
      </section>



      <!-- MODAL PROVEEDOR -->
      <div class="modal fade af-modal" id="modalProveedor" tabindex="-1" aria-labelledby="modalProveedorLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
          <div class="modal-content modal-proveedor-content">
            <div class="modal-header modal-proveedor-header">
              <h5 class="modal-title" id="modalProveedorLabel">
                <i class="bi bi-person-lines-fill me-2"></i>Datos del Proveedor
              </h5>
              <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Cerrar"></button>
            </div>

            <form id="formProveedor" class="modal-proveedor-form needs-validation" novalidate>
              <input type="hidden" name="id" id="proveedorId">
              <div class="modal-body modal-proveedor-body">
                <div class="row g-3">
                  <div class="col-md-4">
                    <label for="nombre" class="form-label">Nombre / Empresa</label>
                    <input type="text" class="form-control" name="nombre" id="nombre" autocomplete="off" required>
                  </div>
                  <div class="col-md-4">
                    <label for="contacto" class="form-label">Contacto</label>
                    <input type="text" class="form-control" name="contacto" autocomplete="off" id="contacto">
                  </div>
                  <div class="col-md-4">
                    <label for="telefono" class="form-label">Tel√©fono</label>
                    <input type="text" class="form-control" name="telefono" autocomplete="off" id="telefono">
                  </div>
                  <div class="col-md-4">
                    <label for="mail" class="form-label">Email</label>
                    <input type="email" class="form-control" name="mail" autocomplete="off" id="mail">
                  </div>
                  <div class="col-md-4">
                    <label for="direccion" class="form-label">Direcci√≥n</label>
                    <input type="text" class="form-control" name="direccion" autocomplete="off" id="direccion">
                  </div>
                  <div class="col-md-4">
                    <label for="ciudad" class="form-label">Ciudad</label>
                    <input type="text" class="form-control" name="ciudad" autocomplete="off" id="ciudad">
                  </div>
                  <div class="col-md-4">
                    <label for="provincia" class="form-label">Provincia</label>
                    <input type="text" class="form-control" name="provincia" autocomplete="off" id="provincia">
                  </div>
                  <div class="col-md-4">
                    <label for="cuit" class="form-label">CUIT</label>
                    <input type="text" class="form-control" name="cuit" autocomplete="off" id="cuit">
                  </div>
                  <div class="col-md-4">
                    <label for="banco" class="form-label">Banco</label>
                    <input type="text" class="form-control" name="banco" autocomplete="off" id="banco">
                  </div>
                  <div class="col-md-4">
                    <label for="cbu" class="form-label">CBU</label>
                    <input type="text" class="form-control" name="cbu" autocomplete="off" id="cbu">
                  </div>
                  <div class="col-md-4">
                    <label for="alias" class="form-label">Alias</label>
                    <input type="text" class="form-control" name="alias" autocomplete="off" id="alias">
                  </div>
                  <div class="col-md-4">
                    <label for="descuento" class="form-label">Descuento (%)</label>
                    <input type="number" class="form-control" autocomplete="off" name="descuento" id="descuento" min="0" max="100" step="0.01">
                  </div>
                </div>
              </div>

              <div class="modal-footer modal-proveedor-footer">
                <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">
                  <i class="bi bi-x-circle me-1"></i>Cancelar
                </button>
                <div class="d-flex gap-2">
                  <button type="button" class="btn btn-danger d-none" id="btnEliminarProveedor">
                    <i class="bi bi-trash me-1"></i>Eliminar
                  </button>
                  <button type="submit" class="btn btn-success">
                    <i class="bi bi-check2-circle me-1"></i>Guardar Cambios
                  </button>
                </div>
              </div>
            </form>

          </div>
        </div>
      </div>

      <!-- =============== CATALOGOS =============== -->
<section class="panel-catalogos af-card" data-af="catalogos">
  <h5 class="af-card__title">Cat√°logos (Categor√≠as, Marcas, Modelos)</h5>

  <div class="row g-3">
    <!-- CATEGORIAS -->
    <div class="col-md-4">
      <div class="af-card p-3">
        <h6 class="af-card__title">Categor√≠as</h6>
        <div class="d-flex gap-2 mb-2">
          <button id="btnNuevaCategoria" class="btn btn-sm btn-success">+ Nueva</button>
          <button id="btnEditarCategoria" class="btn btn-sm btn-warning" disabled>Editar</button>
          <button id="btnEliminarCategoria" class="btn btn-sm btn-danger" disabled>Eliminar</button>
        </div>
        <select id="selectCategoria" class="form-select">
          <option value="">Cargando...</option>
        </select>
      </div>
    </div>

    <!-- MARCAS -->
    <div class="col-md-4">
      <div class="af-card p-3">
        <h6 class="af-card__title">Marcas</h6>
        <div class="d-flex gap-2 mb-2">
          <button id="btnNuevaMarca" class="btn btn-sm btn-success">+ Nueva</button>
          <button id="btnEditarMarca" class="btn btn-sm btn-warning" disabled>Editar</button>
          <button id="btnEliminarMarca" class="btn btn-sm btn-danger" disabled>Eliminar</button>
        </div>
        <select id="selectMarca" class="form-select">
          <option value="">Cargando...</option>
        </select>
      </div>
    </div>

    <!-- MODELOS -->
    <div class="col-md-4">
      <div class="af-card p-3">
        <h6 class="af-card__title">Modelos</h6>
        <div class="d-flex gap-2 mb-2">
          <button id="btnNuevoModelo" class="btn btn-sm btn-success">+ Nuevo</button>
          <button id="btnEditarModelo" class="btn btn-sm btn-warning" disabled>Editar</button>
          <button id="btnEliminarModelo" class="btn btn-sm btn-danger" disabled>Eliminar</button>
        </div>
        <div class="mb-2">
          <label class="form-label">Filtrar por marca</label>
          <select id="filtroMarcaModelos" class="form-select">
            <option value="">Todas</option>
          </select>
        </div>
        <select id="selectModelo" class="form-select">
          <option value="">Cargando...</option>
        </select>
      </div>
    </div>
  </div>
</section>

<!-- ===== Modales Cat√°logos (mismo estilo que Proveedores) ===== -->
<div class="modal fade af-modal" id="modalCategoria" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog">
    <form id="formCategoria" class="modal-content">
      <div class="modal-header modal-proveedor-header">
        <h5 class="modal-title">Categor√≠a</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <input type="hidden" id="categoriaId">
        <div class="mb-3">
          <label class="form-label">Nombre</label>
          <input class="form-control" id="categoriaNombre" required>
        </div>
      </div>
      <div class="modal-footer modal-proveedor-footer">
        <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancelar</button>
        <button type="submit" class="btn btn-success">Guardar</button>
      </div>
    </form>
  </div>
</div>

<div class="modal fade af-modal" id="modalMarca" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog">
    <form id="formMarca" class="modal-content">
      <div class="modal-header modal-proveedor-header">
        <h5 class="modal-title">Marca</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <input type="hidden" id="marcaId">
        <div class="mb-3">
          <label class="form-label">Nombre</label>
          <input class="form-control" id="marcaNombre" required>
        </div>
      </div>
      <div class="modal-footer modal-proveedor-footer">
        <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancelar</button>
        <button type="submit" class="btn btn-success">Guardar</button>
      </div>
    </form>
  </div>
</div>

<div class="modal fade af-modal" id="modalModelo" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog">
    <form id="formModelo" class="modal-content">
      <div class="modal-header modal-proveedor-header">
        <h5 class="modal-title">Modelo</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <input type="hidden" id="modeloId">
        <div class="mb-3">
          <label class="form-label">Marca</label>
          <select id="modeloMarcaId" class="form-select" required></select>
        </div>
        <div class="mb-3">
          <label class="form-label">Nombre</label>
          <input class="form-control" id="modeloNombre" required>
        </div>
      </div>
      <div class="modal-footer modal-proveedor-footer">
        <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancelar</button>
        <button type="submit" class="btn btn-success">Guardar</button>
      </div>
    </form>
  </div>
</div>

      <!-- =============== FACTURAS =============== -->
      <section class="panel-facturas af-card" data-af="facturas">
        <h5 class="af-card__title">Registrar Factura</h5>

        <div class="mb-3">
          <label for="facturaProveedor" class="form-label">Proveedor</label>
          <select id="facturaProveedor" class="form-select">
            <option value="">Seleccionar proveedor...</option>
            <% proveedores.forEach(p => { %>
              <option value="<%= p.id %>"><%= p.nombre %></option>
            <% }) %>
          </select>
        </div>

        <div class="mb-3">
          <label for="facturaFecha" class="form-label">Fecha Factura</label>
          <input type="date" id="facturaFecha" class="form-control">
        </div>

        <div class="mb-3">
          <label for="facturaFechaPago" class="form-label">Fecha Vencimiento</label>
          <input type="date" id="facturaFechaPago" class="form-control">
        </div>

        <div class="mb-3">
          <label for="facturaNumero" class="form-label">N√∫mero de factura</label>
          <input type="text" id="facturaNumero" class="form-control">
        </div>

        <div class="mb-3">
          <label for="facturaImporteTotal" class="form-label">Importe total con IVA</label>
          <input type="number" step="0.01" id="facturaImporteTotal" class="form-control">
        </div>

        <div class="mb-3">
          <label for="facturaIVA" class="form-label">IVA</label>
          <select id="facturaIVA" class="form-select">
            <option value="">Seleccionar IVA...</option>
            <option value="21">21%</option>
            <option value="10.5">10.5%</option>
          </select>
        </div>

        <div class="mb-3">
          <label for="facturaImporteBruto" class="form-label">Importe bruto</label>
          <input type="number" step="0.01" id="facturaImporteBruto" class="form-control">
        </div>

        <button id="btnAgregarProductosFactura" class="btn btn-primary ms-0 mb-2">Agregar Productos</button>

        <div class="mb-3">
          <label for="facturaCondicion" class="form-label">Estado del pago</label>
          <select id="facturaCondicion" class="form-select">
            <option value="pendiente" selected>PENDIENTE</option>
            <option value="pagado">PAGADO</option>
          </select>
        </div>

        <div class="mb-3">
          <label for="facturaAdministrador" class="form-label">Administrador</label>
          <select id="facturaAdministrador" class="form-select" required>
            <option value="">Seleccionar administrador...</option>
            <option value="GERARDO">GERARDO</option>
            <option value="CHACHO">CHACHO</option>
            <option value="WALTER">WALTER</option>
          </select>
        </div>

        <div class="d-flex justify-content-end mt-3">
          <button id="btnGuardarFactura" class="btn btn-success">Guardar Factura</button>
        </div>
      </section>

      <!-- MODAL Productos Factura -->
      <div class="modal fade af-modal" id="modalProductosFactura" tabindex="-1" aria-labelledby="modalProductosFacturaLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-proveedor-dialog">
          <div class="modal-content modal-proveedor-content">
            <div class="modal-header modal-proveedor-header">
              <h5 class="modal-title" id="modalProductosFacturaLabel">
                <i class="bi bi-box-seam me-2"></i>Productos de la Factura
              </h5>
              <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Cerrar"></button>
            </div>

            <div class="modal-body modal-proveedor-body">
              <div class="mb-3 position-relative">
                <label for="buscadorProducto" class="form-label">Buscar producto</label>
                <input type="text" class="form-control" id="buscadorProducto" placeholder="Escrib√≠ el nombre o c√≥digo...">
                <div id="resultadosBusqueda" class="list-group mt-1"></div>
              </div>

              <div class="table-responsive mt-4">
                <table class="table table-bordered table-sm align-middle text-center" id="tablaProductosFactura">
                  <thead class="table-light">
                    <tr>
                      <th>C√≥digo Prov.</th>
                      <th>Producto</th>
                      <th>Imagen</th>
                      <th>Cantidad</th>
                      <th>Acci√≥n</th>
                    </tr>
                  </thead>
                  <tbody></tbody>
                </table>
              </div>
            </div>

            <div class="modal-footer modal-proveedor-footer">
              <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Cerrar</button>
              <button type="button" class="btn btn-success" id="btnConfirmarProductosFactura">Confirmar Productos</button>
            </div>
          </div>
        </div>
      </div>

      <!-- =============== PRESUPUESTOS =============== -->
      <section class="panel-presupuestos af-card" data-af="presupuestos">
        <h5 class="af-card__title">Registrar Presupuesto</h5>

        <div class="mb-3">
          <label for="presupuestoProveedor" class="form-label">Proveedor</label>
          <select id="presupuestoProveedor" class="form-select">
            <option value="">Seleccionar proveedor...</option>
            <% proveedores.forEach(p => { %>
              <option value="<%= p.id %>"><%= p.nombre %></option>
            <% }) %>
          </select>
        </div>

        <div class="mb-3">
          <label for="presupuestoFecha" class="form-label">Fecha del presupuesto</label>
          <input type="date" id="presupuestoFecha" class="form-control">
        </div>

        <div class="mb-3">
          <label for="presupuestoFechaPago" class="form-label">Fecha Vencimiento</label>
          <input type="date" id="presupuestoFechaPago" class="form-control">
        </div>

        <div class="mb-3">
          <label for="presupuestoNumero" class="form-label">N√∫mero</label>
          <input type="text" id="presupuestoNumero" class="form-control">
        </div>

        <div class="mb-3">
          <label for="presupuestoImporte" class="form-label">Importe total</label>
          <input type="number" step="0.01" id="presupuestoImporte" class="form-control">
        </div>

        <button id="btnAgregarProductosPresupuesto" class="btn btn-primary ms-0 mb-2">Agregar Productos</button>

        <div class="mb-3">
          <label for="presupuestoCondicion" class="form-label">Estado del pago</label>
          <select id="presupuestoCondicion" class="form-select">
            <option value="pendiente" selected>PENDIENTE</option>
            <option value="pagado">PAGADO</option>
          </select>
        </div>

        <div class="mb-3">
          <label for="presupuestoAdministrador" class="form-label">Administrador</label>
          <select id="presupuestoAdministrador" class="form-select" required>
            <option value="">Seleccionar administrador...</option>
            <option value="GERARDO">GERARDO</option>
            <option value="CHACHO">CHACHO</option>
            <option value="WALTER">WALTER</option>
          </select>
        </div>

        <div class="d-flex justify-content-end mt-3">
          <button id="btnGuardarPresupuesto" class="btn btn-success">Guardar Presupuesto</button>
        </div>
      </section>

      <!-- MODAL Productos Presupuesto -->
      <div class="modal fade af-modal" id="modalProductosPresupuesto" tabindex="-1" aria-labelledby="modalProductosPresupuestoLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-proveedor-dialog">
          <div class="modal-content modal-proveedor-content">
            <div class="modal-header modal-proveedor-header">
              <h5 class="modal-title" id="modalProductosPresupuestoLabel">
                <i class="bi bi-box-seam me-2"></i>Productos del Presupuesto
              </h5>
              <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Cerrar"></button>
            </div>

            <div class="modal-body modal-proveedor-body">
              <div class="mb-3 position-relative">
                <label for="buscadorProductoPresupuesto" class="form-label">Buscar producto</label>
                <input type="text" class="form-control" id="buscadorProductoPresupuesto" placeholder="Escrib√≠ el nombre o c√≥digo...">
                <div id="resultadosBusquedaPresupuesto" class="list-group mt-1"></div>
              </div>

              <div class="table-responsive mt-4">
                <table class="table table-bordered table-sm align-middle text-center" id="tablaProductosPresupuesto">
                  <thead class="table-light">
                    <tr>
                      <th>C√≥digo Prov.</th>
                      <th>Producto</th>
                      <th>Imagen</th>
                      <th>Cantidad</th>
                      <th>Acci√≥n</th>
                    </tr>
                  </thead>
                  <tbody></tbody>
                </table>
              </div>
            </div>

            <div class="modal-footer modal-proveedor-footer">
              <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Cerrar</button>
              <button type="button" class="btn btn-success" id="btnConfirmarProductosPresupuesto">Confirmar Productos</button>
            </div>
          </div>
        </div>
      </div>

      <!-- =============== LISTADOS =============== -->
      <section class="panel-listados af-card" data-af="listados">
        <h5 class="af-card__title">Listado de Facturas y Presupuestos</h5>

        <div class="mb-3">
          <label for="filtroProveedor" class="form-label">Proveedor</label>
          <select id="filtroProveedor" class="form-select">
            <option value="">Todos los proveedores</option>
            <% proveedores.forEach(p => { %>
              <option value="<%= p.id %>"><%= p.nombre %></option>
            <% }) %>
          </select>
        </div>

        <div class="mb-3">
          <label for="filtroTipo" class="form-label">Tipo</label>
          <select id="filtroTipo" class="form-select">
            <option value="">Todos</option>
            <option value="factura">Facturas</option>
            <option value="presupuesto">Presupuestos</option>
          </select>
        </div>

        <div class="mb-3">
          <label for="filtroNumero" class="form-label">N√∫mero</label>
          <input type="text" id="filtroNumero" class="form-control" placeholder="Ej: 001-12345">
        </div>

        <div class="mb-3">
          <label class="form-label">Fecha Desde</label>
          <input type="date" id="filtroFechaDesde" class="form-control">
        </div>

        <div class="mb-3">
          <label class="form-label">Fecha Hasta</label>
          <input type="date" id="filtroFechaHasta" class="form-control">
        </div>

        <div class="mb-3">
          <label for="filtroCondicion" class="form-label">Condici√≥n</label>
          <select id="filtroCondicion" class="form-select">
            <option value="">Todas</option>
            <option value="pendiente">Pendiente</option>
            <option value="pagado">Pagado</option>
          </select>
        </div>

        <div class="af-actions-row">
          <button id="btnGenerarPDFResumenFacturas" class="btn-admin-facturas">üìÑ Resumen Facturas</button>
          <button id="btnGenerarPDFResumenPresupuestos" class="btn-admin-presupuestos">üìù Resumen Presupuestos</button>
          <button id="btnVerVencimientos" class="btn-admin-vencimientos">üìÜ Ver Vencimientos</button>
        </div>

        <div class="d-grid mt-3">
          <button class="btn btn-primary" id="btnBuscarListados">Buscar</button>
        </div>
      </section>

      <!-- MODAL Resultados Listados -->
      <div class="modal fade af-modal" id="modalResultadosListados" tabindex="-1" aria-labelledby="modalResultadosListadosLabel" aria-hidden="true">
        <div class="modal-dialog modal-xl modal-proveedor-dialog">
          <div class="modal-content modal-proveedor-content">
            <div class="modal-header modal-proveedor-header">
              <h5 class="modal-title" id="modalResultadosListadosLabel">
                <i class="bi bi-journal-text me-2"></i>Resultados de la b√∫squeda
              </h5>
              <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Cerrar"></button>
            </div>

            <div class="modal-body modal-proveedor-body">
              <div class="row" id="contenedorResultadosListados"></div>

              <div class="d-flex justify-content-between align-items-center mt-4">
                <button class="btn btn-outline-secondary" id="btnAnteriorPagina" disabled>‚Üê Anterior</button>
                <span id="indicadorPagina" class="fw-bold">P√°gina 1</span>
                <button class="btn btn-outline-secondary" id="btnSiguientePagina" disabled>Siguiente ‚Üí</button>
              </div>
            </div>

            <div class="modal-footer modal-proveedor-footer">
              <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Cerrar</button>
            </div>
          </div>
        </div>
      </div>

      <!-- MODAL Detalle Documento -->
      <div class="modal fade af-modal" id="modalDetalleDocumento" tabindex="-1" aria-labelledby="modalDetalleDocumentoLabel" aria-hidden="true">
        <div class="modal-dialog modal-xl">
          <div class="modal-content modal-proveedor-content">
            <div class="modal-header modal-proveedor-header">
              <h5 class="modal-title" id="modalDetalleDocumentoLabel">
                <i class="bi bi-file-earmark-text me-2"></i>Detalle del Documento
              </h5>
              <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Cerrar"></button>
            </div>
            <div class="modal-body" id="contenedorDetalleDocumento"></div>
            <div class="modal-footer">
              <a id="btnImprimirDetallePDF" href="#" target="_blank" class="btn btn-outline-secondary mt-3">
                <i class="bi bi-printer me-1"></i> Imprimir Comprobante
              </a>

              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
              <button type="button" id="btnHabilitarEdicion" class="btn btn-warning">Editar</button>
              <button type="button" id="btnEliminarDocumento" class="btn btn-danger">Eliminar</button>
              <button type="button" id="btnGuardarCambiosDocumento" class="btn btn-success d-none">Guardar Cambios</button>
            </div>
          </div>
        </div>
      </div>

    </div> <!-- /af-admin__grid -->
  </main>

  <%- include('./layouts/footer.ejs') %>
  <script src="/js/proveedores.js"></script>
  <script src="/js/facturasAdministracion.js"></script>
  <script src="/js/presupuestosAdministracion.js"></script>
  <script src="/js/listadosDocumentos.js"></script>
  <script src="/js/catalogosAdmin.js"></script>

</body>
