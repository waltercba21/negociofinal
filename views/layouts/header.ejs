<header>
  <style>
    /* ================== HEADER (solo estilos) ================== */
header{
  position: sticky;
  top: 0;
  z-index: 1000;
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap: 12px;
  padding: 12px 16px;
  background: rgba(12, 16, 24, .78);
  border-bottom: 1px solid rgba(255,255,255,.10);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
}

header > a{ display:flex; align-items:center; }
header .logo{
  height: 36px;
  width: auto;
  display:block;
}

/* NAV desktop */
header .navbar{
  display:flex;
  align-items:center;
  gap: 10px;
}

header .nav-link,
header .nav-link-factura,
header .navbar a{
  padding: 10px 12px;
  border-radius: 999px;
  border: 1px solid rgba(255,255,255,.10);
  background: rgba(255,255,255,.06);
  transition: transform 160ms ease, background 160ms ease, box-shadow 160ms ease;
  white-space: nowrap;
}

@media (hover:hover){
  header .nav-link:hover,
  header .nav-link-factura:hover,
  header .navbar a:hover{
    background: rgba(255,255,255,.10);
    box-shadow: 0 10px 26px rgba(0,0,0,.25);
    transform: translateY(-1px);
  }
}

/* ICONOS derecha */
header .icons{
  display:flex;
  align-items:center;
  gap: 10px;
}

header .logueado{
  display:flex;
  align-items:center;
  gap: 10px;
}

header .logueado a{
  display:inline-flex;
  align-items:center;
  gap: 8px;
  padding: 10px 12px;
  border-radius: 999px;
  border: 1px solid rgba(255,255,255,.10);
  background: rgba(255,255,255,.06);
}

header .logueado p{
  margin:0;
  font-size: 14px;
  opacity: .9;
}

/* Badges carrito / pedidos */
header .cantidad-alerta,
header .pedido-alerta{
  min-width: 18px;
  height: 18px;
  padding: 0 6px;
  display:inline-flex;
  align-items:center;
  justify-content:center;
  border-radius: 999px;
  font-size: 12px;
  font-weight: 700;
  background: #ef4444;
  color: #fff;
  box-shadow: 0 10px 22px rgba(239,68,68,.25);
}

/* HAMBURGER */
header .hamburger{
  display:none; /* desktop off */
  border: 1px solid rgba(255,255,255,.12);
  background: rgba(255,255,255,.06);
  border-radius: 14px;
  padding: 10px 12px;
  font-size: 18px;
  line-height: 1;
  cursor:pointer;
}

/* ================== MOBILE ================== */
@media (max-width: 820px){
  header{
    flex-wrap: wrap;
    gap: 10px;
    padding: 10px 12px;
  }

  /* Orden: logo - icons - hamburger, y nav abajo */
  header > a{ order: 1; }
  header .icons{ order: 2; margin-left: auto; }
  header .hamburger{ order: 3; display:inline-flex; align-items:center; justify-content:center; }
  header .navbar{ order: 4; width: 100%; }

  /* En mobile el nav pasa a “panel” */
  header .navbar{
    display:none;
    flex-direction: column;
    align-items: stretch;
    gap: 8px;
    padding: 10px 0 12px;
    margin-top: 4px;
    border-top: 1px solid rgba(255,255,255,.08);
  }

  /* Soporta 2 formas comunes de toggle:
     1) toggleMenu agrega clase .active/.open
     2) toggleMenu setea style="display: block/flex"
  */
  header .navbar.active,
  header .navbar.open,
  header .navbar[style*="display: block"],
  header .navbar[style*="display: flex"]{
    display:flex !important;
  }

  header .nav-link,
  header .nav-link-factura,
  header .navbar a{
    border-radius: 16px;
    padding: 12px 14px;
    background: rgba(255,255,255,.06);
  }

  /* Reducir ruido en mobile: saludo y texto “Salir” */
  header .logueado p{ display:none; }
  header .logueado a span{ display:none; }
}

  </style>
  <a href="/">
    <img class="logo" src="/uploads/productos/logo.png" alt="LOGO" />
  </a>

  <button class="hamburger" onclick="toggleMenu()">☰</button>

  <nav class="navbar">
    <a class="nav-link" href="/">INICIO</a>
    <a class="nav-link" href="/productos">PRODUCTOS</a>

    <% if (!isAdminUser) { %>  <!-- ✅ Solo se muestra si NO es administrador -->
      <a class="nav-link" href="/productos/ofertas">OFERTAS</a>
      <a class="nav-link" href="https://wa.me/+543513820440/" target="_blank">WHATSAPP</a>
      <a class="nav-link" href="#" onclick="abrirMapa(); return false;">UBICACIÓN</a>
    <% } %>

    <% if (isAdminUser) { %>  <!-- ✅ Solo se muestra para Administradores -->
      <a class="nav-link" href="/productos/panelControl">PANEL CONTROL</a>
      <a class="nav-link" href="/productos/presupuestoMostrador">PRESUPUESTO</a>
      <a class="nav-link-factura" href="/productos/facturasMostrador">FACTURAS</a>
      <!-- ✅ NUEVO: Gastos -->
      <a class="nav-link" href="/administracion/gastos" id="gastos-btn">GASTOS</a>
      
      <!-- ✅ Botón para Administración -->
      <a class="nav-link" href="/administracion" id="admin-btn">
        ADMINISTRACIÓN
      </a>

      <!-- ✅ Botón para Pedidos con notificación -->
      <a class="nav-link pedidos-icon" href="/pedidos" id="pedidos-btn">
        PEDIDOS
        <span id="pedido-notificacion" class="pedido-alerta" style="display: none;">0</span>
      </a>
    <% } %>
  </nav>

  <div class="icons">
    <% if (isLogged) { %>
      <div class="logueado"> 
        <a href="/users/profile"> 
          <p>Hola <%= userLogged.nombre %> </p> 
        </a>

        <% if (!isAdminUser) { %>  <!-- ✅ Solo se muestra si NO es administrador -->
          <a href="/carrito" class="carrito-icon">
            <i class="fa-solid fa-cart-shopping"></i>
            <span id="carrito-notificacion" class="cantidad-alerta" 
                  <% if (cantidadCarrito <= 0) { %> style="display: none;" <% } %>>
                <%= cantidadCarrito %>
            </span>
          </a>
        <% } %>          
      
        <a href="/users/logout">
          <i class="fa-solid fa-right-from-bracket"></i>
          <span>Salir</span> 
        </a>
      </div>
    <% } else { %>
      <a href="/users/login">Iniciar Sesión</a>
      <a class="register-link" href="/users/register">Registrarme</a>
    <% } %>  
</div>


<script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>

  <script>
      const socket = io();

      socket.on('connect', () => {
      });

      socket.on('actualizarNotificacion', (data) => {
          actualizarPedidosPendientes();
      });

      async function actualizarPedidosPendientes() {
          try {
              const response = await fetch('/pedidos/cantidad');  
              const data = await response.json();

              const notificacion = document.getElementById("pedido-notificacion");
              if (data.cantidad > 0) {
                  notificacion.textContent = data.cantidad;
                  notificacion.style.display = "flex";
              } else {
                  notificacion.style.display = "none";
              }
          } catch (error) {
              console.error("❌ Error al obtener pedidos pendientes:", error);
          }
      }

      actualizarPedidosPendientes();
  </script>
</header>
