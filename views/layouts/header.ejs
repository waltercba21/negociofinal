<header class="af-header">
<nav id="af-nav" class="af-header__nav navbar">
<a class="af-header__link nav-link" href="/">INICIO</a>
<a class="af-header__link nav-link" href="/productos">PRODUCTOS</a>


<% if (!isAdminUser) { %>
<a class="af-header__link nav-link" href="/productos/ofertas">OFERTAS</a>
<a class="af-header__link nav-link" href="https://wa.me/+543513820440/" target="_blank" rel="noopener">WHATSAPP</a>
<a class="af-header__link nav-link" href="#" onclick="abrirMapa(); return false;">UBICACIÓN</a>
<% } %>


<% if (isAdminUser) { %>
<a class="af-header__link nav-link" href="/productos/panelControl">PANEL CONTROL</a>
<a class="af-header__link nav-link" href="/productos/presupuestoMostrador">PRESUPUESTO</a>
<a class="af-header__link nav-link nav-link-factura" href="/productos/facturasMostrador">FACTURAS</a>
<a class="af-header__link nav-link" href="/administracion" id="admin-btn">ADMINISTRACIÓN</a>
<a class="af-header__link nav-link pedidos-icon" href="/pedidos" id="pedidos-btn">
PEDIDOS
<span id="pedido-notificacion" class="pedido-alerta" style="display: none;">0</span>
</a>
<% } %>
</nav>


<div class="af-header__icons icons">
<% if (isLogged) { %>
<div class="af-header__user logueado">
<a href="/users/profile" class="af-header__hello">
<p>Hola <%= userLogged.nombre %></p>
</a>


<% if (!isAdminUser) { %>
<a href="/carrito" class="af-header__cart carrito-icon" aria-label="Carrito">
<i class="fa-solid fa-cart-shopping"></i>
<span id="carrito-notificacion" class="cantidad-alerta" <% if (cantidadCarrito <= 0) { %> style="display: none;" <% } %>><%= cantidadCarrito %></span>
</a>
<% } %>


<a href="/users/logout" class="af-header__logout">
<i class="fa-solid fa-right-from-bracket"></i>
<span>Salir</span>
</a>
</div>
<% } else { %>
<a class="af-header__auth" href="/users/login">Iniciar Sesión</a>
<a class="af-header__auth register-link" href="/users/register">Registrarme</a>
<% } %>
</div>
</div>


<script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
<script>
const socket = io();
socket.on('actualizarNotificacion', () => { actualizarPedidosPendientes(); });
async function actualizarPedidosPendientes() {
try {
const res = await fetch('/pedidos/cantidad');
const data = await res.json();
const el = document.getElementById('pedido-notificacion');
if (!el) return;
if (data.cantidad > 0) { el.textContent = data.cantidad; el.style.display = 'flex'; }
else { el.style.display = 'none'; }
} catch (e) { console.error('❌ Error al obtener pedidos pendientes:', e); }
}
actualizarPedidosPendientes();
</script>
</header>