<!-- Vista estilizada de Pedido Manual -->
<%- include('./layouts/head.ejs') %>
<%- include('./layouts/header.ejs') %>
<body>
 <main>
    <div class="container mt-4">
        <h2>📦 Historial de Pedidos</h2>
      
        <!-- 🔍 Formulario de Filtros -->
        <form method="GET" action="/productos/historialPedidos" class="mb-4">
            <div class="row">
              <div class="col-md-3">
                <label for="fechaDesde">Fecha Desde</label>
                <input type="date" name="fechaDesde" id="fechaDesde" class="form-control" value="<%= fechaDesde || '' %>">
              </div>
              <div class="col-md-3">
                <label for="fechaHasta">Fecha Hasta</label>
                <input type="date" name="fechaHasta" id="fechaHasta" class="form-control" value="<%= fechaHasta || '' %>">
              </div>
              <div class="col-md-3">
                <label for="proveedor">Proveedor</label>
                <select name="proveedor" id="proveedor" class="form-control">
                  <option value="">Todos</option>
                  <% proveedores.forEach(p => { %>
                    <option value="<%= p.id %>" <%= proveedorSeleccionado == p.id ? 'selected' : '' %>><%= p.nombre %></option>
                  <% }) %>
                </select>
              </div>
              <div class="col-md-3 d-flex align-items-end">
                <button type="submit" class="btn btn-primary w-100">Filtrar</button>
              </div>
            </div>
          </form>
          
      
        <% if (historial.length === 0) { %>
          <p>No hay pedidos registrados con los filtros seleccionados.</p>
        <% } else { %>
          <table class="table table-bordered table-hover mt-3">
            <thead class="thead-dark">
              <tr>
                <th># Pedido</th>
                <th>Fecha</th>
                <th>Proveedor</th>
                <th>Total</th>
                <th>Acciones</th>
              </tr>
            </thead>
            <tbody>
              <% historial.forEach(pedido => { %>
                <tr>
                  <td><%= pedido.pedido_id %></td>
                  <td><%= new Date(pedido.fecha).toLocaleDateString() %></td>
                  <td><%= pedido.proveedor %></td>
                  <td>$<%= Number(pedido.total).toFixed(2) %></td>
                  <td>
                    <a href="/productos/verPedido/<%= pedido.pedido_id %>" class="btn btn-sm btn-info">Ver detalle</a>
                  </td>
                </tr>
              <% }) %>
            </tbody>
          </table>
        <% } %>
      </div>
 </main>

  </script><%- include('./layouts/footer.ejs') %>
</body>
