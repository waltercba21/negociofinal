<%- include('./layouts/head.ejs') %>
<%- include('./layouts/header.ejs') %>

<body>
    <main class="carrito-container">
        <h1>üõçÔ∏è Mi Carrito</h1>
        <div class="progreso-compra">

            <div class="barra activa">
                <div class="paso activo">
                    <i class="fas fa-shopping-cart"></i>
                    <span>CARRITO</span>
                </div>
                <div class="barra"></div>
                <div class="paso">
                    <i class="fas fa-truck"></i>
                    <span>ENV√çO</span>
                </div>
                <div class="barra"></div>
                <div class="paso">
                    <i class="fas fa-check-circle"></i>
                    <span>CONFIRMAR DATOS</span>
                <div class="barra"></div>
                </div>
                <div class="barra"></div>
                <div class="paso">
                    <i class="fas fa-credit-card"></i>
                    <span>PAGO</span>
                </div>
            </div>
        </div>
        <% if (productos.length > 0) { %>
            <table class="carrito-tabla">
                <thead>
                    <tr>
                        <th>Imagen</th>
                        <th>Producto</th>
                        <th>Cantidad</th>
                        <th>Precio</th>
                        <th>Sub-Total</th>
                    </tr>
                </thead>
                <tbody>
                    <% productos.forEach(function(producto) { %>
                        <tr>
                            <td><img src="/uploads/productos/<%= producto.imagen || 'default.jpg' %>" class="imagen-miniatura"></td>
                            <td><%= producto.nombre %></td>
                            <td><%= producto.cantidad %></td>
                            <td>$<%= producto.precio_venta.toFixed(2) %></td>
                            <td>$<%= producto.total.toFixed(2) %></td>
                        </tr>
                    <% }) %>
                    <tr class="carrito-total">
                        <td colspan="3"></td>
                        <td><strong>Total</strong></td>
                        <td>$<%= total %></td>
                    </tr>
                </tbody>
            </table>
        <% } %>
        <div> 
            <button id="continuar-envio" class="btn-finalizar">Continuar con el Env√≠o</button>
        </div>
        
        <% if (typeof estadoCarrito !== 'undefined' && estadoCarrito) { %>
            <div class="estado-pedido">
                <h2>üì¶ Tu pedido est√° en proceso</h2>
                <p>Estado actual: <strong><%= estadoCarrito %></strong></p>
                
                <% if (estadoCarrito === "preparaci√≥n") { %>
                    <p>üõí Puedes pasar a retirarlo en nuestro local.</p>
                <% } else if (estadoCarrito === "listo para entrega") { %>
                    <p>üöö En breve recibir√°s tu pedido en tu domicilio.</p>
                <% } else { %>
                    <p>‚åõ Estamos procesando tu pedido.</p>
                <% } %>
        
            </div>
        <% } else { %>
            <p class="carrito-vacio">No tienes productos en tu carrito.</p>
        <% } %>
        

        <% if (typeof comprobante !== 'undefined' && comprobante) { %>
            <div class="comprobante-container">
                <a href="/comprobantes/<%= comprobante %>" download class="btn-finalizar">üìÑ Descargar Comprobante</a>
            </div>
        <% } %>
    </main>
    <script src="/js/carrito.js"></script> 
    <%- include('./layouts/footer.ejs') %>
</body>
