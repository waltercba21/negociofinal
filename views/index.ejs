<%- include ./layouts/head.ejs %>
<%- include ./layouts/header.ejs %>
  <body class="body-index">  
    <main>
      <div class="peliculas-recomendadas contenedor">
          <div class="contenedor-principal">
              <button role="button" id="flecha-izquierda" class="flecha-izquierda"><i class="fa-solid fa-angle-left"></i></button>
              <div class="contenedor-carrousel">
                  <div class="carrousel">
                      <div class="pelicula">
                          <a href="/productos?categoria=31"><img class="imagen-carrusel" data-categoria="31" src="uploads/productos/faros-led1.webp" alt=""></a>
                          <div class="tarjeta-texto">
                              <p>FAROS AUXILIARES LED</p>
                          </div>
                      </div>
                      <div class="pelicula">
                          <a href="/productos?categoria=30"><img class="imagen-carrusel" data-categoria="30" src="uploads/productos/faro-trasero-led1.webp" alt=""></a>
                          <div class="tarjeta-texto">
                              <p>FAROS TRASEROS LED</p>
                          </div>
                      </div>
                      <div class="pelicula">
                          <a href="/productos?categoria=25"><img class="imagen-carrusel" data-categoria="25" src="uploads/productos/opticas-led1.webp" alt=""></a>
                          <div class="tarjeta-texto">
                              <p>OPTICAS LED</p>
                          </div>
                      </div>
                      <div class="pelicula">
                          <a href="/productos?categoria=28"><img class="imagen-carrusel" data-categoria="28" src="uploads/productos/lamparas-led1.webp" alt=""></a>
                          <div class="tarjeta-texto">
                              <p>LAMPARAS LED</p>
                          </div>
                      </div>
                      <div class="pelicula">
                          <a href="/productos?categoria=2"><img class="imagen-carrusel" data-categoria="2" src="uploads/productos/lamparas1.webp" alt=""></a>
                          <div class="tarjeta-texto">
                              <p>LAMPARAS</p>
                          </div>
                      </div>
                      <div class="pelicula">
                          <a href="/productos?categoria=15"><img class="imagen-carrusel" data-categoria="15" src="uploads/productos/16.webp" alt=""></a>
                          <div class="tarjeta-texto">
                              <p>FAROS AUXILIARES</p>
                          </div>
                      </div>
                      <div class="pelicula">
                          <a href="/productos?categoria=16"><img class="imagen-carrusel" data-categoria="16" src="uploads/productos/14.webp" alt=""></a>
                          <div class="tarjeta-texto">
                              <p>BARRAS LED</p>
                          </div>
                      </div>
                      <div class="pelicula">
                          <a href="/productos?categoria=5"><img class="imagen-carrusel" data-categoria="5" src="uploads/productos/10.webp" alt=""></a>
                          <div class="tarjeta-texto">
                              <p>FAROS LED</p>
                          </div>
                      </div>
                      <div class="pelicula">
                          <a href="/productos?categoria=12"><img class="imagen-carrusel" data-categoria="12" src="uploads/productos/3.webp" alt=""></a>
                          <div class="tarjeta-texto">
                              <p>LINEA UNIVERSAL</p>
                          </div>
                      </div>
                      <div class="pelicula">
                          <a href="/productos?categoria=13"><img class="imagen-carrusel" data-categoria="13" src="uploads/productos/2.webp" alt=""></a>
                          <div class="tarjeta-texto">
                              <p>LINEA CAMIONES</p>
                          </div>
                      </div>
                      <div class="pelicula">
                          <a href="/productos?categoria=9"><img class="imagen-carrusel" data-categoria="9" src="uploads/productos/5.webp" alt=""></a>
                          <div class="tarjeta-texto">
                              <p>ESPEJOS UNIVERSALES</p>
                          </div>
                      </div>
                      <div class="pelicula">
                          <a href="/productos?categoria=14"><img class="imagen-carrusel" data-categoria="14" src="uploads/productos/6.webp" alt=""></a>
                          <div class="tarjeta-texto">
                              <p>VIDRIOS DE ESPEJOS</p>
                          </div>
                      </div>
                      <div class="pelicula">
                          <a href="/productos?categoria=11"><img class="imagen-carrusel" data-categoria="11" src="uploads/productos/4.webp" alt=""></a>
                          <div class="tarjeta-texto">
                              <p>VIDRIOS DE OPTICAS</p>
                          </div>
                      </div>
                  </div>
                  <button role="button" id="flecha-derecha" class="flecha-derecha"><i class="fa-solid fa-angle-right"></i></button>
              </div>
          </div>
      </div>
  
      <div class="contenedor-principal-productos">
        
        <div class="ultimos-productos contenedor-ultimos">
          <h2 class="titulo-ultimos">ÚLTIMOS AGREGADOS</h2> <!-- ⬅ centrado desde CSS -->
        
          <div class="contenedor-productos-ultimos">
            <% productos.forEach(function(producto) { %>
              <div class="card-ultimo">
                <div class="cover-card-ultimo">
                  <% if (producto.imagen && producto.imagen.length > 0) { %>
                    <img src="../../uploads/productos/<%= producto.imagen[0] %>" alt="<%= producto.nombre %>">
                  <% } else { %>
                    <img src="/ruta/valida/a/imagen/por/defecto.jpg" alt="<%= producto.nombre %>">
                  <% } %>
                </div>
        
                <div class="titulo-producto-ultimo">
                  <h3 class="nombre-ultimo"><%= producto.nombre %></h3>
                </div>
        
                <hr>
        
                <div class="categoria-producto-ultimo">
                  <h5 class="categoria-ultimo"><%= producto.categoria_nombre %></h5>
                </div>
        
                <div class="precio-producto-ultimo">
                  <p class="precio-ultimo">
                    <%= new Intl.NumberFormat('es-CL', { style: 'currency', currency: 'CLP' }).format(producto.precio_venta) %>
                  </p>
                </div>
              </div>
            <% }); %>
          </div>
        </div>
        
        
        <div class="ofertas-productos contenedor-ofertas">
         
          <h2>OFERTAS</h2>

          <div class="contenedor-carrousel-ofertas">
            <button class="flecha-izquierda-ofertas"><i class="fas fa-chevron-left"></i></button>
            
            <div class="contenedor-productos-ofertas">
              <% productosOferta.forEach(function(oferta) { %>
                <div class="card-oferta">
                  
                  <div class="cover-card-oferta">
                    <% if (oferta.imagenes && oferta.imagenes.length > 0) { %>
                      <img src="../../uploads/productos/<%= oferta.imagenes[0] %>" alt="<%= oferta.nombre %>">
                    <% } else { %>
                      <img src="/ruta/valida/a/imagen/por/defecto.jpg" alt="<%= oferta.nombre %>">
                    <% } %>
                  </div>
          
                  <div class="titulo-producto-oferta">
                    <h3 class="nombre-oferta"><%= oferta.nombre %></h3>
                  </div>
          
                  <hr>
          
                  <div class="categoria-producto-oferta">
                    <h5 class="categoria-oferta"><%= oferta.categoria_nombre %></h5>
                  </div>
          
                  <div class="precio-producto-oferta">
                    <p class="precio-oferta">
                      <%= new Intl.NumberFormat('es-CL', { style: 'currency', currency: 'CLP' }).format(oferta.precio_venta) %>
                    </p>
                  </div>
                </div>
              <% }); %>
            </div>
          
            <button class="flecha-derecha-ofertas"><i class="fas fa-chevron-right"></i></button>
          </div>
          
        </div>

          </div>
      </main>
    
    <%- include ./layouts/footer.ejs %>
    <script src="js/index.js"></script> 
    <script>
     document.addEventListener("DOMContentLoaded", function () {
  const contenedor = document.querySelector(".contenedor-productos-ultimos");
  const tarjetas = document.querySelectorAll(".card-ultimo");
  let index = 0;

  if (window.innerWidth <= 768 && tarjetas.length > 1) {
    const totalTarjetas = tarjetas.length;

    // Aseguramos que el contenedor tenga ancho suficiente
    contenedor.style.width = `${100 * totalTarjetas}%`;

    // A cada tarjeta le damos un ancho fijo (100% de la pantalla)
    tarjetas.forEach(t => {
      t.style.width = "100%";
      t.style.flex = "0 0 100%";
    });

    setInterval(() => {
      index = (index + 1) % totalTarjetas;
      contenedor.style.transform = `translateX(-${index * 100}%)`;
    }, 4000); // Cambia cada 4 segundos
  }
});
      </script>
      
</body>
</html>