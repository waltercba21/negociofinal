<%- include ./layouts/head.ejs %>
<%- include ./layouts/header.ejs %>

<body class="body-index af-has-bottomnav">
  <style>
    /* ===== Index v1 ===== */
    main{ padding: 14px 0 24px; }

    .af-hero{ padding: 6px 0 10px; }
    .af-hero__card{
      width:min(1200px, calc(100% - 28px));
      margin: 0 auto;
      background: linear-gradient(135deg, rgba(0,63,125,.10), rgba(217,4,41,.06));
      border: 1px solid rgba(0,63,125,.12);
      border-radius: var(--af-radius);
      box-shadow: var(--af-shadow-sm);
      padding: 14px;
      display:flex;
      gap: 12px;
      align-items:center;
      justify-content:space-between;
      flex-wrap: wrap;
    }
    .af-hero__text h1{
      font-size: clamp(18px, 3.8vw, 28px);
      margin: 0;
      font-weight: 900;
      letter-spacing: .2px;
    }
    .af-hero__text p{
      margin: 6px 0 0;
      color: var(--af-muted);
      font-weight: 600;
    }
    .af-hero__actions{
      display:flex;
      gap:10px;
      flex-wrap: wrap;
    }

    /* Carrusel categorías (thumb friendly) */
    .peliculas-recomendadas{ margin-top: 12px; }
    .peliculas-recomendadas .contenedor{ width:min(1200px, calc(100% - 28px)); margin:0 auto; }

    .contenedor-principal{ position: relative; }
    .contenedor-carrousel{
      overflow: auto;
      scroll-snap-type: x mandatory;
      -webkit-overflow-scrolling: touch;
      padding: 6px 0 10px;
    }
    .carrousel{
      display:flex;
      gap: 12px;
      padding: 2px;
      width: max-content;
    }
    .pelicula{
      scroll-snap-align: start;
      width: 160px;
      border-radius: 18px;
      overflow:hidden;
      background: #fff;
      border: 1px solid var(--af-border);
      box-shadow: var(--af-shadow-sm);
      transition: transform .15s ease, box-shadow .15s ease;
    }
    .pelicula:hover{ transform: translateY(-2px); box-shadow: var(--af-shadow); }
    .pelicula a{ display:block; }
    .imagen-carrusel{
      width: 100%;
      height: 110px;
      object-fit: cover;
    }
    .tarjeta-texto{
      padding: 10px 10px 12px;
      font-weight: 900;
      letter-spacing: .2px;
      font-size: 12px;
      color: var(--af-text);
    }

    /* Flechas: solo desktop */
    .flecha-izquierda, .flecha-derecha{
      display:none;
      position:absolute;
      top: 50%;
      transform: translateY(-50%);
      width: var(--af-tap);
      height: var(--af-tap);
      border-radius: 999px;
      border: 1px solid var(--af-border);
      background: rgba(255,255,255,.92);
      box-shadow: var(--af-shadow);
      z-index: 5;
    }
    .flecha-izquierda{ left: -10px; }
    .flecha-derecha{ right: -10px; }

    /* Secciones productos */
    .contenedor-principal-productos{
      width:min(1200px, calc(100% - 28px));
      margin: 14px auto 0;
      display: grid;
      gap: 16px;
    }
    .ultimos-productos, .ofertas-productos{
      background: var(--af-surface);
      border: 1px solid var(--af-border);
      border-radius: var(--af-radius);
      box-shadow: var(--af-shadow-sm);
      padding: 14px;
    }
    .ultimos-productos h2, .ofertas-productos h2{
      margin: 0 0 10px;
      font-weight: 1000;
      letter-spacing: .2px;
      font-size: 18px;
    }

    /* Cards */
    .contenedor-productos-ultimos,
    .contenedor-productos-ofertas{
      display:grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 12px;
    }
    .card-ultimo, .card-oferta{
      border-radius: 18px;
      overflow:hidden;
      border: 1px solid var(--af-border);
      background: #fff;
      box-shadow: var(--af-shadow-sm);
      transition: transform .15s ease, box-shadow .15s ease;
    }
    .card-ultimo:hover, .card-oferta:hover{ transform: translateY(-2px); box-shadow: var(--af-shadow); }
    .cover-card-ultimo img, .cover-card-oferta img{
      width: 100%;
      height: 140px;
      object-fit: contain;
      background: linear-gradient(180deg, rgba(2,8,23,.04), rgba(2,8,23,.00));
      padding: 10px;
    }
    .titulo-producto-ultimo, .titulo-producto-oferta{ padding: 10px 10px 0; }
    .nombre-ultimo, .nombre-oferta{
      margin: 0;
      font-size: 13px;
      font-weight: 900;
      line-height: 1.2;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
      min-height: 32px;
    }
    hr{ margin: 10px; border-color: rgba(15,23,42,.10); }
    .categoria-producto-ultimo, .categoria-producto-oferta{ padding: 0 10px; }
    .categoria-ultimo, .categoria-oferta{
      margin: 0;
      font-size: 12px;
      font-weight: 800;
      color: var(--af-muted);
    }
    .precio-producto-ultimo, .precio-producto-oferta{ padding: 10px; }
    .precio-ultimo, .precio-oferta{
      margin: 0;
      font-size: 15px;
      font-weight: 1000;
      color: var(--af-blue);
    }

    /* Desktop: más columnas */
    @media (min-width: 900px){
      .contenedor-productos-ultimos,
      .contenedor-productos-ofertas{
        grid-template-columns: repeat(4, minmax(0, 1fr));
      }
      .flecha-izquierda, .flecha-derecha{ display:inline-flex; align-items:center; justify-content:center; }
      .imagen-carrusel{ height: 120px; }
    }
  </style>

  <main>
    <section class="af-hero">
      <div class="af-hero__card">
        <div class="af-hero__text">
          <h1>Iluminación para tu vehículo, sin vueltas.</h1>
          <p>Buscá rápido, mirá ofertas y consultá por WhatsApp.</p>
        </div>
        <div class="af-hero__actions">
          <a class="af-btn af-btn--primary" href="/productos">Explorar productos</a>
          <a class="af-btn af-btn--soft" href="/productos/ofertas">Ver ofertas</a>
          <a class="af-btn af-btn--ghost" href="https://wa.me/+543513820440/" target="_blank">
            <i class="fa-brands fa-whatsapp"></i> WhatsApp
          </a>
        </div>
      </div>
    </section>

    <div class="peliculas-recomendadas contenedor">
      <div class="contenedor-principal">
        <button role="button" id="flecha-izquierda" class="flecha-izquierda" aria-label="Categorías anteriores">
          <i class="fa-solid fa-angle-left"></i>
        </button>

        <div class="contenedor-carrousel">
          <div class="carrousel">
            <div class="pelicula">
              <a href="/productos?categoria=31">
                <img class="imagen-carrusel" data-categoria="31" src="uploads/productos/faros-led1.webp" alt="Faros auxiliares LED" loading="lazy" decoding="async">
              </a>
              <div class="tarjeta-texto"><p>FAROS AUXILIARES LED</p></div>
            </div>

            <div class="pelicula">
              <a href="/productos?categoria=30">
                <img class="imagen-carrusel" data-categoria="30" src="uploads/productos/faro-trasero-led1.webp" alt="Faros traseros LED" loading="lazy" decoding="async">
              </a>
              <div class="tarjeta-texto"><p>FAROS TRASEROS LED</p></div>
            </div>

            <div class="pelicula">
              <a href="/productos?categoria=25">
                <img class="imagen-carrusel" data-categoria="25" src="uploads/productos/opticas-led1.webp" alt="Ópticas LED" loading="lazy" decoding="async">
              </a>
              <div class="tarjeta-texto"><p>OPTICAS LED</p></div>
            </div>

            <div class="pelicula">
              <a href="/productos?categoria=28">
                <img class="imagen-carrusel" data-categoria="28" src="uploads/productos/lamparas-led1.webp" alt="Lámparas LED" loading="lazy" decoding="async">
              </a>
              <div class="tarjeta-texto"><p>LAMPARAS LED</p></div>
            </div>

            <div class="pelicula">
              <a href="/productos?categoria=2">
                <img class="imagen-carrusel" data-categoria="2" src="uploads/productos/lamparas1.webp" alt="Lámparas" loading="lazy" decoding="async">
              </a>
              <div class="tarjeta-texto"><p>LAMPARAS</p></div>
            </div>

            <div class="pelicula">
              <a href="/productos?categoria=15">
                <img class="imagen-carrusel" data-categoria="15" src="uploads/productos/16.webp" alt="Faros auxiliares" loading="lazy" decoding="async">
              </a>
              <div class="tarjeta-texto"><p>FAROS AUXILIARES</p></div>
            </div>

            <div class="pelicula">
              <a href="/productos?categoria=16">
                <img class="imagen-carrusel" data-categoria="16" src="uploads/productos/14.webp" alt="Barras LED" loading="lazy" decoding="async">
              </a>
              <div class="tarjeta-texto"><p>BARRAS LED</p></div>
            </div>

            <div class="pelicula">
              <a href="/productos?categoria=5">
                <img class="imagen-carrusel" data-categoria="5" src="uploads/productos/10.webp" alt="Faros LED" loading="lazy" decoding="async">
              </a>
              <div class="tarjeta-texto"><p>FAROS LED</p></div>
            </div>

            <div class="pelicula">
              <a href="/productos?categoria=12">
                <img class="imagen-carrusel" data-categoria="12" src="uploads/productos/3.webp" alt="Línea universal" loading="lazy" decoding="async">
              </a>
              <div class="tarjeta-texto"><p>LINEA UNIVERSAL</p></div>
            </div>

            <div class="pelicula">
              <a href="/productos?categoria=13">
                <img class="imagen-carrusel" data-categoria="13" src="uploads/productos/2.webp" alt="Línea camiones" loading="lazy" decoding="async">
              </a>
              <div class="tarjeta-texto"><p>LINEA CAMIONES</p></div>
            </div>

            <div class="pelicula">
              <a href="/productos?categoria=9">
                <img class="imagen-carrusel" data-categoria="9" src="uploads/productos/5.webp" alt="Espejos universales" loading="lazy" decoding="async">
              </a>
              <div class="tarjeta-texto"><p>ESPEJOS UNIVERSALES</p></div>
            </div>

            <div class="pelicula">
              <a href="/productos?categoria=14">
                <img class="imagen-carrusel" data-categoria="14" src="uploads/productos/6.webp" alt="Vidrios de espejos" loading="lazy" decoding="async">
              </a>
              <div class="tarjeta-texto"><p>VIDRIOS DE ESPEJOS</p></div>
            </div>

            <div class="pelicula">
              <a href="/productos?categoria=11">
                <img class="imagen-carrusel" data-categoria="11" src="uploads/productos/4.webp" alt="Vidrios de ópticas" loading="lazy" decoding="async">
              </a>
              <div class="tarjeta-texto"><p>VIDRIOS DE OPTICAS</p></div>
            </div>
          </div>
        </div>

        <button role="button" id="flecha-derecha" class="flecha-derecha" aria-label="Categorías siguientes">
          <i class="fa-solid fa-angle-right"></i>
        </button>
      </div>
    </div>

    <div class="contenedor-principal-productos">
      <div class="ultimos-productos contenedor-ultimos">
        <h2 class="titulo-ultimos">ÚLTIMOS AGREGADOS</h2>

        <div class="contenedor-productos-ultimos">
          <% productos.forEach(function(producto) { %>
            <div class="card-ultimo">
              <div class="cover-card-ultimo">
                <% if (producto.imagen && producto.imagen.length > 0) { %>
                  <img src="../../uploads/productos/<%= producto.imagen[0] %>" alt="<%= producto.nombre %>" loading="lazy" decoding="async">
                <% } else { %>
                  <img src="/ruta/valida/a/imagen/por/defecto.jpg" alt="<%= producto.nombre %>" loading="lazy" decoding="async">
                <% } %>
              </div>

              <div class="titulo-producto-ultimo">
                <h3 class="nombre-ultimo"><%= producto.nombre %></h3>
              </div>

              <hr>

              <div class="categoria-producto-ultimo">
                <h5 class="categoria-ultimo"><%= producto.categoria_nombre %></h5>
              </div>

              <div class="precio-producto-ultimo">
                <p class="precio-ultimo">
                  <%= new Intl.NumberFormat('es-CL', { style: 'currency', currency: 'CLP' }).format(producto.precio_venta) %>
                </p>
              </div>
            </div>
          <% }); %>
        </div>
      </div>

      <div class="ofertas-productos contenedor-ofertas">
        <h2>OFERTAS</h2>

        <div class="contenedor-productos-ofertas">
          <% productosOferta.forEach(function(oferta) { %>
            <div class="card-oferta">
              <div class="cover-card-oferta">
                <% if (oferta.imagenes && oferta.imagenes.length > 0) { %>
                  <img src="../../uploads/productos/<%= oferta.imagenes[0] %>" alt="<%= oferta.nombre %>" loading="lazy" decoding="async">
                <% } else { %>
                  <img src="/ruta/valida/a/imagen/por/defecto.jpg" alt="<%= oferta.nombre %>" loading="lazy" decoding="async">
                <% } %>
              </div>

              <div class="titulo-producto-oferta">
                <h3 class="nombre-oferta"><%= oferta.nombre %></h3>
              </div>

              <hr>

              <div class="categoria-producto-oferta">
                <h5 class="categoria-oferta"><%= oferta.categoria_nombre %></h5>
              </div>

              <div class="precio-producto-oferta">
                <p class="precio-oferta">
                  <%= new Intl.NumberFormat('es-CL', { style: 'currency', currency: 'CLP' }).format(oferta.precio_venta) %>
                </p>
              </div>
            </div>
          <% }); %>
        </div>
      </div>
    </div>
  </main>

  <%- include ./layouts/footer.ejs %>

  <script src="js/index.js"></script>
  <script>
    // Tu JS existente (lo dejo). Recomendación UX: más adelante lo cambiamos por scroll-snap sin auto-slide.
    document.addEventListener("DOMContentLoaded", function () {
      const contenedor = document.querySelector(".contenedor-productos-ultimos");
      const tarjetas = document.querySelectorAll(".card-ultimo");

      if (window.innerWidth <= 768 && tarjetas.length > 1) {
        let index = 0;
        const total = tarjetas.length;

        tarjetas.forEach((tarjeta) => {
          tarjeta.style.minWidth = "100%";
        });

        setInterval(() => {
          index = (index + 1) % total;
          contenedor.style.transform = `translateX(-${index * 100}%)`;
        }, 4000);
      }
    });
  </script>
</body>
</html>
